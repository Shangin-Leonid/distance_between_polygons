
include ../common.mk

#--------------------------------------------------------------------------------------------------
# Names of directories and files
#--------------------------------------------------------------------------------------------------

SLIB_DIR := .



#--------------------------------------------------------------------------------------------------
# Flags for C compilation
#--------------------------------------------------------------------------------------------------

$(D_DIR)/%.d : CFLAGS = -MM -MT '$(OBJ_DIR)/$*.o ./$@'



#-----------------------------------------------------------------------------------------------
# RULES
#--------------------------------------------------------------------------------------------------

.PHONY : static_lib clean_slib clean_dirs clean clean_all


# =================================   Статическая библиотека   ========================================

# Создать статическую библиотеку
static_lib: $(SLIB_FILE)

$(SLIB_FILE): $(OBJ_FILES)
	ar crs $(SLIB_FILE) $(OBJ_FILES)
	@echo "\nStatic library file has been SUCCESSFULY created!\n"

# Удалить библиотечный файл
clean_slib:
	rm -v -f $(SLIB_FILE)


# =================================   Clean   ==============================================

# Удалить все вспомагательные директории с их содержимым
clean_dirs:
	rm -r -f $(OBJ_DIR) $(D_DIR)

# Удалить всё лишнее, оставшееся от сборки
clean: clean_dirs

# Удалить вспомогательные директории вместе с их содержимым и библиотечный файл
# (избавиться от всего-всего, что было создано в результате сборки)
clean_all: clean_dirs clean_slib


#--------------------------------------------------------------------------------------------------
# INCLUDE
#--------------------------------------------------------------------------------------------------

ifeq (,$(findstring clean,$(MAKECMDGOALS)))
ifeq (,$(findstring dir,$(MAKECMDGOALS)))
ifeq (,$(findstring help,$(MAKECMDGOALS)))
# Подключаем файлы зависимостей ('.d') соответствующих данному '.c' файлу.
$(D_FILES):
include $(wildcard $(D_FILES))
endif
endif
endif



#--------------------------------------------------------------------------------------------------
# COMMENTS
#--------------------------------------------------------------------------------------------------
#
# Some variables you can find in common.mk
#
# All makefiles have been written for Linux. Sorry, if you have another OS :-(
# I wish you could understand my make-code and then rewrite some parts.
#